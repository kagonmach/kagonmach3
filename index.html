<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="google-site-verification" content="EVg4xnJw3nUhs6KE6N3ohNVe0wAapAHLhykoi3XoFV4" />
    <title>かごんまチャンネル22</title>
    <link rel="stylesheet" href="kagoshima1.css">
</head>
<body>
    <header>
        <h1>かごんまチャネル</h1> 
        <nav>
            <ul>
                <li><a href="kagoshima9.html">グルメ</a></li>
                <li><a href="kagoshima10.html">温泉</a></li>
                <li><a href="kagoshima11.html">イベント</a></li>
                <li><a href="kagoshima12.html">アクセス</a></li>
                <li><a href="kagoshima13.html">お気に入りの場所</a></li>
                <li><a href="kagoshima.14.html">便利な情報</a></li>
                <li><a href="kagoshima15.html">愚痴</a></li>
            </ul>
        </nav>
        <img src="sakurajima22.png" alt="">
    </header>
    <main>
        
        <section class="hero">
            <img src="sakurajima.jpg" alt="鹿児島市からの桜島">
        </section>
        <section class="about">
            <div class="container"></div>
            <h2>かごんまチャンネルの使い方</h2>
            <p>このサイトは、鹿児島のいいところや便利な情報を共有するサイトです。
                #グルメ、＃温泉、＃イベント、＃交通、＃お気に入りの場所、＃便利な情報これらいずれかのハッシュタグをコメント内に入れて投稿してください。
                このサイトを通して、今まで知らなかった鹿児島の魅力を深めていこう。もちろん愚痴も大歓迎（桜島の灰がだるいなど。。。）このサイトは世界で唯一の鹿児島について語るサイト。
                写真協力：公益社団法人　鹿児島県観光連盟、©ken.n.miffy.752
            </p>

        </section>
    
    </main>
    <aside>
  <input id="author" placeholder="ニックネームをいれてね（省略可）">
     <textarea id="content" placeholder="投稿内容"></textarea>
      <input id="imageInput" type="file" accept="image/*">
      <button id="submitBtn">投稿</button>
      <div id="posts"></div>
    </aside>
　　<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
　　<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
<script>
// Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyAIiRPFlbp6MBTnKeR4_6T8z4weGwa3Bkc",
  authDomain: "kagoshima-sns.firebaseapp.com",
  projectId: "kagoshima-sns",
  storageBucket: "kagoshima-sns.firebasestorage.app",
  messagingSenderId: "771420231919",
  appId: "1:771420231919:web:c7a3ce1e49b0946d79631a"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
    db.collection("test").add({
  message: "Firestore接続テスト",
  time: new Date()
})
.then(() => {
  alert("✅ Firestoreにデータを送信できました！");
})
.catch((error) => {
  alert("❌ Firestore接続エラー: " + error);
});


const $posts = document.getElementById('posts');
const escapeHtml = str => str.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');

function renderPost(doc){
  const data = doc.data();
  const div = document.createElement('div');
  div.className = 'post';
  div.dataset.id = doc.id;
  div.innerHTML = `
    <strong>${escapeHtml(data.author||'名無し')}</strong>
    <div>${escapeHtml(data.content)}</div>
    ${data.image||'' ? `<img src="${data.image}">` : ''}
    <div class="actions">
      <button class="likeBtn">👍 ${data.likes||0}</button>
      <button class="deleteBtn">削除</button>
    </div>
  `;
  $posts.prepend(div);

  // イベント
  div.querySelector('.likeBtn').addEventListener('click', ()=>{
    const ref = db.collection('posts').doc(doc.id);
    ref.update({likes: firebase.firestore.FieldValue.increment(1)});
  });
  div.querySelector('.deleteBtn').addEventListener('click', ()=>{
    const user = document.getElementById('author').value.trim() || '名無し';
    if(user !== (data.author||'名無し')){ alert('自分の投稿しか削除できません'); return; }
    if(confirm('本当に削除しますか？')){
      db.collection('posts').doc(doc.id).delete();
    }
  });
}

// Firestoreリアルタイム取得
db.collection('posts').orderBy('createdAt','desc').onSnapshot(snapshot=>{
  $posts.innerHTML='';
  snapshot.forEach(doc=>renderPost(doc));
});

// 画像をBase64に変換
function toBase64(file){return new Promise(res=>{
  if(!file) return res(null);
  const reader = new FileReader();
  reader.onload = e=>res(e.target.result);
  reader.readAsDataURL(file);
});}

document.getElementById('submitBtn').addEventListener('click', async ()=>{
  const author = document.getElementById('author').value.trim();
  const content = document.getElementById('content').value.trim();
  const file = document.getElementById('imageInput').files[0];
  if(!content){alert('本文を入力してください');return;}
  const image = await toBase64(file);
  await db.collection('posts').add({
    author, content, image,
    likes:0,
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  });
  document.getElementById('content').value='';
  document.getElementById('imageInput').value='';
});
</script>


</body>

</html>




















